<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Load d3.js and necessary libraries -->
    <script src="https://d3js.org/d3.v4.js"></script>
    <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
    <script src="https://d3js.org/d3-geo-projection.v2.min.js"></script>
    <meta charset="UTF-8">
    <title>AirQo Maps</title>
        <style>
        /* Add any necessary CSS styles for the map */
        #map-container {
            width: 100%;
            height: 500px;
        }
    </style>
</head>

<body>
    <!-- Create an SVG container -->
    <svg id="map-container" width="960" height="600"></svg>

    {% block script %}
    <script>
    // Get the JSON data from Flask route
    var jsonData = JSON.parse('{{ results|safe }}');

    // Create the SVG container
    var svg = d3.select("#map-container")
        .append("svg")
        .attr("width", "100%")
        .attr("height", "100%");

    // Create a projection
    var projection = d3.geoMercator()
        .center([0, 0])
        .scale(150)
        .translate([svg.attr("width") / 2, svg.attr("height") / 2]);

    // Create a path generator
    var path = d3.geoPath()
        .projection(projection);

    // Define the color scale
    var colorScale = d3.scaleSequential(d3.interpolateBlues)
        .domain([0, d3.max(jsonData, function(d) { return d.pm2_5; })]);

    // Draw the map
    svg.selectAll("path")
        .data(jsonData)
        .enter()
        .append("path")
        .attr("d", path)
        .style("fill", function(d) { return colorScale(d.pm2_5); });
    </script>
    {% endblock %}
</body>
</html>
